---
- hosts: all
  become: yes

  tasks:
    - name: Add Cloud SDK distribution URI 
      shell: echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list

    - name: Install dependencies
      package:
        name: "{{ item }}"
        state: latest
      with_items:
        - apt-transport-https
        - ca-certificates
        - gnupg

    - name: Installing Cloud SDK key
      apt_key:
        url: https://packages.cloud.google.com/apt/doc/apt-key.gpg 
        keyring: /usr/share/keyrings/cloud.google.gpg
        state: present

    - name: Installing Cloud SDK
      apt:
        name: "{{ my.tools.google_cloud_sdk.components }}"
        state: latest
        update_cache: yes